id: android-xxe-vulnerability

info:
  name: Android XML External Entity (XXE) Vulnerability
  author: mohammad
  severity: high
  description: |
    Detects improper XML parsing configurations that allow external entity injection (XXE), which can lead to sensitive data exposure, SSRF, or DoS attacks.
  tags: android, security, xml, xxe, cwe-611

file:
  - extensions:
      - smali
      - java
      - xml
    matchers:
      # Detect vulnerable XML parsing configurations
      - type: regex
        regex:
          - 'Lorg/xml/sax/SAXParserFactory;->newInstance\(\)'  # Insecure SAXParserFactory
          - 'Ljavax/xml/parsers/DocumentBuilderFactory;->newInstance\(\)'  # Insecure DocumentBuilderFactory
          - 'Ljavax/xml/parsers/SAXParserFactory;->setFeature\(Ljava/lang/String;Z\)V'
          - 'Ljavax/xml/parsers/DocumentBuilderFactory;->setFeature\(Ljava/lang/String;Z\)V'
        condition: or

      # Detect missing secure XML parser configurations (XXE prevention should be explicitly disabled)
      - type: regex
        regex:
          - '"http://apache.org/xml/features/disallow-doctype-decl", true'  # Secure feature
          - '"http://xml.org/sax/features/external-general-entities", false'
          - '"http://xml.org/sax/features/external-parameter-entities", false'
        condition: and