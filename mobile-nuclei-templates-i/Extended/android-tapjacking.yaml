id: android-tapjacking
info:
  name: Tapjacking Vulnerability
  author: mohammad
  severity: high
  description: |
    The application does not prevent overlay attacks (tapjacking), making it vulnerable to clickjacking attacks.
  reference:
    - https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured(boolean)
    - https://support.google.com/accessibility/android/answer/11183340
  tags: android, security, overlay, tapjacking

file:
  - extensions:
      - xml
  - pattern: '<application[^>]*android:allowTaskReparenting="true"[^>]*>'
    matchers-condition: or
  - pattern: '<activity[^>]*android:windowSoftInputMode="stateAlwaysVisible"[^>]*>'
    matchers-condition: or
  - pattern: '<application[^>]*android:secure="false"[^>]*>'
    matchers-condition: or
  - pattern: 'setFilterTouchesWhenObscured\(false\)'
    matchers-condition: or
  - pattern: 'setFlags\(WindowManager\.LayoutParams\.FLAG_SECURE, 0\)'

matchers:
  - type: regex
    part: body
    regex:
      - '<application[^>]*android:allowTaskReparenting="true"[^>]*>'
      - '<activity[^>]*android:windowSoftInputMode="stateAlwaysVisible"[^>]*>'
      - '<application[^>]*android:secure="false"[^>]*>'
      - 'setFilterTouchesWhenObscured\(false\)'
      - 'setFlags\(WindowManager\.LayoutParams\.FLAG_SECURE, 0\)'
